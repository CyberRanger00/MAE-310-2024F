% 单元的刚度矩阵
function Ke = elementStiffness(coords, E, nu, planeStress)
    %构建本构矩阵
    if planeStress%平面应力条件
        C = E / (1 - nu^2) * [1, nu, 0; nu, 1, 0; 0, 0, (1 - nu) / 2];
    else          %平面应变条件
        C = E / ((1 + nu) * (1 - 2 * nu)) * [1 - nu, nu, 0; nu, 1 - nu, 0; 0, 0, (1 - 2 * nu) / 2];
    end
    %{ε} = [B]{d}
    %计算B矩阵（应变-位移矩阵）和雅可比行列式
    x1 = coords(1, 1); y1 = coords(1, 2);
    x2 = coords(2, 1); y2 = coords(2, 2);
    x3 = coords(3, 1); y3 = coords(3, 2);
    
    %构造矩阵A用于计算三角形的面积
    A = [1, x1, y1; 1, x2, y2; 1, x3, y3];
    %雅可比行列式的值等于三角形面积，A/2
    detJ = det(A) / 2;

    %存储形函数关于x和y的偏导数计算所需的坐标差值
    b = [y2 - y3; y3 - y1; y1 - y2];
    c = [x3 - x2; x1 - x3; x2 - x1];
    
    %构建一个3×6的矩阵，用于将节点位移转换为应变
    %矩阵的三行分别对应εx (x方向应变)、εy (y方向应变)和γxy (剪切应变)
    %每两列对应一个节点的x和y方向位移
    B = [b(1), 0, b(2), 0, b(3), 0;
         0, c(1), 0, c(2), 0, c(3);
         c(1), b(1), c(2), b(2), c(3), b(3)] / (2 * detJ);
    %计算单元刚度矩阵
    %C是材料的本构矩阵，表示应力与应变的关系
    %B矩阵通过上述公式参与计算单元刚度矩阵Ke
    %detJ代表三角形单元的面积
    Ke = B' * C * B * detJ;
end
